[gd_scene load_steps=33 format=3 uid="uid://cpg817r11rxxe"]

[ext_resource type="Texture2D" uid="uid://jkh3db66e5w3" path="res://player/Health indicator (full).webp" id="1_h1oyn"]
[ext_resource type="Texture2D" uid="uid://buel4iifkemvw" path="res://player/pause.png" id="2_pm0b2"]
[ext_resource type="Texture2D" uid="uid://dyhosqkkw550k" path="res://player/restart.png" id="3_6tax7"]
[ext_resource type="Texture2D" uid="uid://dj0g5ye0dmrbq" path="res://player/fullscreen.png" id="3_7ejf0"]
[ext_resource type="Texture2D" uid="uid://c7w7w04ymhr1m" path="res://player/idle-mouse.png" id="3_ki1ma"]
[ext_resource type="Texture2D" uid="uid://bbn1mcu6qaovu" path="res://player/attack-mouse.png" id="4_d36ju"]
[ext_resource type="Texture2D" uid="uid://b0gr36oxtbq6j" path="res://player/coin.png" id="5_iavf7"]
[ext_resource type="FontFile" uid="uid://5fqp282we4x2" path="res://fonts/Pixelify_Sans/static/PixelifySans-Regular.ttf" id="5_lipyx"]
[ext_resource type="Texture2D" uid="uid://ds6siicrhahi8" path="res://player/delete_portal.png" id="5_uk65h"]
[ext_resource type="Texture2D" uid="uid://p0hbynlugb2f" path="res://player/wizard_hat.png" id="6_gtsf6"]
[ext_resource type="Texture2D" uid="uid://ebwjernenu5x" path="res://player/upgrade icons/fortune cookie icon.png" id="8_5s7ip"]
[ext_resource type="Texture2D" uid="uid://iuv4kbwss6ke" path="res://player/upgrade icons/fortune cookie opened.png" id="9_kcx3t"]

[sub_resource type="GDScript" id="GDScript_fp6gk"]
script/source = "extends Control


@export var player: Player


func _ready() -> void:
	propagate_call(\"set_player\", [player])
	Input.mouse_mode = Input.MOUSE_MODE_HIDDEN


func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		$Pause.visible = !$Pause.visible
		get_tree().paused = $Pause.visible
		if $Pause.visible:
			Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
		else:
			Input.mouse_mode = Input.MOUSE_MODE_HIDDEN
			
"

[sub_resource type="GDScript" id="GDScript_w8sf7"]
script/source = "extends HBoxContainer


const FULL: Texture2D = preload(\"res://player/Health indicator (full).webp\")
const EMPTY: Texture2D = preload(\"res://player/Health indicator (empty).webp\")


func set_player(player: Player) -> void:
	var health := Health.get_health_component(player)
	health.health_changed.connect(
		func(new_health: int):
			for i in range(0, new_health):
				get_child(i).texture = FULL
			for i in range(new_health, get_child_count()):
				get_child(i).texture = EMPTY
	)
	health.max_health_changed.connect(
		func(new_max_health: int):
			if new_max_health >= get_child_count():
				for _i in range(new_max_health - get_child_count()):
					var indicator := TextureRect.new()
					indicator.texture_filter = CanvasItem.TEXTURE_FILTER_NEAREST
					indicator.expand_mode = TextureRect.EXPAND_FIT_WIDTH
					add_child(indicator)
			else:
				for i in range(new_max_health, get_child_count()):
					get_child(i).queue_free()
	)
"

[sub_resource type="Theme" id="Theme_hcktf"]

[sub_resource type="GDScript" id="GDScript_hqk0h"]
script/source = "extends HBoxContainer


const FULL: Texture2D = preload(\"res://player/upgrade icons/shield upgrade icon.png\")


func set_player(player: Player) -> void:
	var health := Health.get_health_component(player)
	health.shield_changed.connect(
		func(new_shield: int):
			if new_shield >= get_child_count():
				for _i in range(new_shield - get_child_count()):
					var indicator := TextureRect.new()
					indicator.texture_filter = CanvasItem.TEXTURE_FILTER_NEAREST
					indicator.expand_mode = TextureRect.EXPAND_FIT_WIDTH
					indicator.texture = FULL
					add_child(indicator)
			else:
				for i in range(new_shield, get_child_count()):
					get_child(i).queue_free()
	)
"

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_28xjp"]
bg_color = Color(0, 0, 0, 0.388235)

[sub_resource type="GDScript" id="GDScript_6fp17"]
script/source = "extends Button


func _ready() -> void:
	if get_window().mode == Window.MODE_FULLSCREEN:
		icon = preload(\"res://player/windowed.png\")
	else:
		icon = preload(\"res://player/fullscreen.png\")


func _on_pressed() -> void:
	if get_window().mode == Window.MODE_FULLSCREEN:
		icon = preload(\"res://player/fullscreen.png\")
		get_window().mode = Window.MODE_WINDOWED
	else:
		icon = preload(\"res://player/windowed.png\")
		get_window().mode = Window.MODE_FULLSCREEN
"

[sub_resource type="GDScript" id="GDScript_adouf"]
script/source = "extends Button


func _on_pressed() -> void:
	OS.set_restart_on_exit(true)
	await get_tree().process_frame
	get_tree().quit()
	#get_tree().change_scene_to_file(\"res://main.tscn\")
"

[sub_resource type="LabelSettings" id="LabelSettings_yloxr"]
font = ExtResource("5_lipyx")
font_size = 30

[sub_resource type="GDScript" id="GDScript_xgkjs"]
script/source = "extends Label


func _ready() -> void:
	text = str(Wallet.coins)
	Wallet.wallet_instance.coins_changed.connect(
		func():
			text = str(Wallet.coins)
	)
"

[sub_resource type="LabelSettings" id="LabelSettings_nklj2"]
font = ExtResource("5_lipyx")
font_size = 30

[sub_resource type="GDScript" id="GDScript_t1ar8"]
script/source = "extends Label


func _ready() -> void:
	text = str(Wallet.wizard_hats)
	Wallet.wallet_instance.wizard_hats_changed.connect(
		func():
			text = str(Wallet.wizard_hats)
	)
"

[sub_resource type="GDScript" id="GDScript_n8btn"]
script/source = "extends Panel


signal _input_received


func set_player(player: Player) -> void:
	player.opening_fortune_cookie.connect(
		func():
			set_process_input(false)
			var anim_player: AnimationPlayer = $AnimationPlayer
			anim_player.play(\"RESET\")
			await create_tween().tween_property(self, \"modulate:a\", 1, 1.0).set_trans(Tween.TRANS_EXPO).finished
			anim_player.play(\"open\")
			await anim_player.animation_finished
			set_process_input(true)
			await _input_received
			create_tween().tween_property(self, \"modulate:a\", 0, 1.0).set_trans(Tween.TRANS_EXPO)
			player._on_opened_fortune_cookie()
	)


func _input(event: InputEvent) -> void:
	if event is InputEventMouseButton:
		if !event.pressed:
			return
	elif event is InputEventKey:
		if !event.pressed:
			return
	elif event is InputEventJoypadButton:
		if !event.pressed:
			return
	else:
		return

	_input_received.emit()
"

[sub_resource type="GDScript" id="GDScript_dskwj"]
script/source = "@tool
extends TextureRect


func _ready() -> void:
	pivot_offset = size / 2
	resized.connect(
		func():
			pivot_offset = size / 2
	)
"

[sub_resource type="LabelSettings" id="LabelSettings_6vwyo"]
font = ExtResource("5_lipyx")
font_size = 32

[sub_resource type="GDScript" id="GDScript_vv52o"]
script/source = "extends Label


var fortunes := \"\"\"Adventure awaits around the next corner.
Your creativity will lead you to success.
A small act of kindness will bring unexpected rewards.
The path to wisdom begins with curiosity.
Your hard work will soon pay off.
A pleasant surprise is in store for you.
The best way to predict the future is to create it.
Your talents will be recognized and rewarded.
A new friendship will bring joy to your life.
Embrace change, for it brings opportunity.
Your positive attitude will attract good things.
A journey of a thousand miles begins with a single step.
Success is the sum of small efforts repeated daily.
The greatest risk is not taking one.
A smile is your passport to the hearts of others.
Your dreams are within reach; pursue them with passion.
Good things come to those who wait, but better things come to those who act.
Your unique perspective will solve an important problem.
Luck favors the prepared mind.
The best time to plant a tree was 20 years ago. The second best time is now.
Your confidence will lead you to great achievements.
An unexpected opportunity will arise. Be ready to seize it.
The only way to do great work is to love what you do.
Your kindness will return to you tenfold.
A goal without a plan is just a wish.
The key to happiness lies within you.
Your perseverance will overcome all obstacles.
Today's efforts will bloom into tomorrow's success.
A new chapter in your life is about to begin.
Your intuition will guide you to the right path.
Believe in yourself and others will too.
The best mirror is an old friend.
Your potential is limitless; dare to explore it.
A small step in the right direction can change your life.
Your optimism will lead you to great heights.
The greatest adventure is what lies ahead.
Your imagination is your only limitation.
Good fortune will be yours if you create it.
A problem is a chance for you to do your best.
Your determination will move mountains.
The best is yet to come.
Your actions today will shape your tomorrow.
A curious mind will never be bored.
Your generosity will open new doors.
The wisdom you seek is already within you.
Your resilience will turn obstacles into opportunities.
A moment of patience can prevent a great disaster.
Your unique talents will bring you unexpected success.
The joy of living comes from giving.
Your future is as bright as your faith.\"\"\".split(\"\\n\")


func random_fortune() -> void:
	text = fortunes[randi_range(0, fortunes.size() - 1)]
"

[sub_resource type="Animation" id="Animation_8dxeu"]
resource_name = "open"
length = 2.5
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("TextureRect:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0, 0, 0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, -0.467748, -0.25, 0, 0.25, 0, 0.378736, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 0.7, 1.1, 1.8)
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("TextureRect:texture")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.9),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [ExtResource("8_5s7ip"), ExtResource("9_kcx3t")]
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = false
tracks/2/path = NodePath("Label:modulate:r")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/3/type = "bezier"
tracks/3/imported = false
tracks/3/enabled = false
tracks/3/path = NodePath("Label:modulate:g")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/4/type = "bezier"
tracks/4/imported = false
tracks/4/enabled = false
tracks/4/path = NodePath("Label:modulate:b")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/5/type = "bezier"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Label:modulate:a")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"handle_modes": PackedInt32Array(0, 0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.25, 0, 0.25, 0, 1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0, 1.8, 2.5)
}
tracks/6/type = "method"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("Label")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(1.8),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"random_fortune"
}]
}

[sub_resource type="Animation" id="Animation_vr5ws"]
length = 0.001
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("TextureRect:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("TextureRect:texture")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("8_5s7ip")]
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = false
tracks/2/path = NodePath("Label:modulate:r")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/3/type = "bezier"
tracks/3/imported = false
tracks/3/enabled = false
tracks/3/path = NodePath("Label:modulate:g")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/4/type = "bezier"
tracks/4/imported = false
tracks/4/enabled = false
tracks/4/path = NodePath("Label:modulate:b")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(1, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/5/type = "bezier"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Label:modulate:a")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_gktww"]
_data = {
"RESET": SubResource("Animation_vr5ws"),
"open": SubResource("Animation_8dxeu")
}

[sub_resource type="GDScript" id="GDScript_telwv"]
script/source = "extends AnimationPlayer


func _ready() -> void:
	play(\"open\")
"

[sub_resource type="GDScript" id="GDScript_pqjgk"]
script/source = "extends Node2D


@onready var idle: Sprite2D = $Idle
@onready var attack: Sprite2D = $Attack
@onready var delete: Sprite2D = $DeletePortal


func _input(event: InputEvent) -> void:
	if event is InputEventMouseMotion:
		position = get_global_mouse_position()

	elif event.is_action_pressed(\"attack\"):
		idle.hide()
		attack.show()
	
	elif event.is_action_released(\"attack\"):
		idle.show()
		attack.hide()


func _process(_delta: float) -> void:
	position = get_global_mouse_position()
	
	if DeletablePortals.deletable_portals > 0:
		delete.show()
		idle.hide()
		attack.hide()
	elif Input.is_action_pressed(\"attack\"):
		delete.hide()
		idle.hide()
		attack.show()
	else:
		delete.hide()
		idle.show()
		attack.hide()
"

[node name="HUD" type="Control"]
process_mode = 3
texture_filter = 1
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = SubResource("GDScript_fp6gk")

[node name="HealthBar" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.03
anchor_top = 0.03
anchor_right = 0.03
anchor_bottom = 0.12
theme_override_constants/separation = 10
script = SubResource("GDScript_w8sf7")

[node name="TextureRect" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect2" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect3" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="ShieldBar" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.03
anchor_top = 0.13
anchor_right = 0.03
anchor_bottom = 0.22
theme_override_constants/separation = 10
script = SubResource("GDScript_hqk0h")

[node name="Pause" type="Panel" parent="."]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_28xjp")

[node name="Pause" type="TextureRect" parent="Pause"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.4
anchor_right = 0.5
anchor_bottom = 0.6
offset_left = -64.8
offset_right = 64.8
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("2_pm0b2")
expand_mode = 2
stretch_mode = 5

[node name="Fullscreen" type="Button" parent="Pause"]
texture_filter = 1
layout_mode = 1
anchors_preset = -1
anchor_left = 0.251
anchor_top = 0.7
anchor_right = 0.45
anchor_bottom = 0.8
grow_horizontal = 0
icon = ExtResource("3_7ejf0")
icon_alignment = 1
expand_icon = true
script = SubResource("GDScript_6fp17")

[node name="Restart" type="Button" parent="Pause"]
texture_filter = 1
layout_mode = 1
anchors_preset = -1
anchor_left = 0.55
anchor_top = 0.7
anchor_right = 0.68
anchor_bottom = 0.8
grow_vertical = 2
icon = ExtResource("3_6tax7")
icon_alignment = 1
expand_icon = true
script = SubResource("GDScript_adouf")

[node name="VBoxContainer2" type="VBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.974
anchor_top = 0.01
anchor_right = 0.99
anchor_bottom = 0.01
offset_left = -40.0
offset_bottom = 40.0
grow_horizontal = 0

[node name="TextureRect" type="TextureRect" parent="VBoxContainer2"]
layout_mode = 2
texture = ExtResource("5_iavf7")
expand_mode = 4
stretch_mode = 5

[node name="TextureRect2" type="TextureRect" parent="VBoxContainer2"]
layout_mode = 2
texture = ExtResource("6_gtsf6")
expand_mode = 4
stretch_mode = 5

[node name="Label" type="Label" parent="."]
custom_minimum_size = Vector2(0, 20)
layout_mode = 1
anchors_preset = -1
anchor_left = 0.889
anchor_top = 0.025
anchor_right = 0.929
anchor_bottom = 0.095
size_flags_vertical = 6
text = "0"
label_settings = SubResource("LabelSettings_yloxr")
horizontal_alignment = 2
vertical_alignment = 1
autowrap_mode = 3
clip_text = true
script = SubResource("GDScript_xgkjs")

[node name="Label2" type="Label" parent="."]
custom_minimum_size = Vector2(0, 20)
layout_mode = 1
anchors_preset = -1
anchor_left = 0.889
anchor_top = 0.115
anchor_right = 0.929
anchor_bottom = 0.173
size_flags_vertical = 6
theme_override_font_sizes/font_size = 16
text = "0"
label_settings = SubResource("LabelSettings_nklj2")
horizontal_alignment = 2
vertical_alignment = 1
autowrap_mode = 3
clip_text = true
script = SubResource("GDScript_t1ar8")

[node name="FortuneCookies" type="Panel" parent="."]
modulate = Color(1, 1, 1, 0)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_28xjp")
script = SubResource("GDScript_n8btn")

[node name="TextureRect" type="TextureRect" parent="FortuneCookies"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.4
anchor_top = 0.4
anchor_right = 0.6
anchor_bottom = 0.6
pivot_offset = Vector2(115.2, 64.8)
texture = ExtResource("8_5s7ip")
expand_mode = 3
stretch_mode = 5
script = SubResource("GDScript_dskwj")

[node name="Label" type="Label" parent="FortuneCookies"]
modulate = Color(1, 1, 1, 0)
layout_mode = 1
anchors_preset = -1
anchor_top = 0.645
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = -20.0
grow_horizontal = 2
grow_vertical = 0
text = "Twest"
label_settings = SubResource("LabelSettings_6vwyo")
horizontal_alignment = 1
vertical_alignment = 1
script = SubResource("GDScript_vv52o")

[node name="AnimationPlayer" type="AnimationPlayer" parent="FortuneCookies"]
libraries = {
"": SubResource("AnimationLibrary_gktww")
}
script = SubResource("GDScript_telwv")

[node name="Node2D" type="Node2D" parent="."]
script = SubResource("GDScript_pqjgk")

[node name="Idle" type="Sprite2D" parent="Node2D"]
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("3_ki1ma")

[node name="Attack" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("4_d36ju")

[node name="DeletePortal" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("5_uk65h")

[connection signal="pressed" from="Pause/Fullscreen" to="Pause/Fullscreen" method="_on_pressed"]
[connection signal="pressed" from="Pause/Restart" to="Pause/Restart" method="_on_pressed"]
