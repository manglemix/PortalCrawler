[gd_scene load_steps=23 format=3 uid="uid://cpg817r11rxxe"]

[ext_resource type="Texture2D" uid="uid://jkh3db66e5w3" path="res://player/Health indicator (full).webp" id="1_h1oyn"]
[ext_resource type="Texture2D" uid="uid://buel4iifkemvw" path="res://player/pause.png" id="2_pm0b2"]
[ext_resource type="Texture2D" uid="uid://dyhosqkkw550k" path="res://player/restart.png" id="3_6tax7"]
[ext_resource type="Texture2D" uid="uid://dj0g5ye0dmrbq" path="res://player/fullscreen.png" id="3_7ejf0"]
[ext_resource type="Texture2D" uid="uid://c7w7w04ymhr1m" path="res://player/idle-mouse.png" id="3_ki1ma"]
[ext_resource type="Texture2D" uid="uid://bbn1mcu6qaovu" path="res://player/attack-mouse.png" id="4_d36ju"]
[ext_resource type="Texture2D" uid="uid://b0gr36oxtbq6j" path="res://player/coin.png" id="5_iavf7"]
[ext_resource type="FontFile" uid="uid://5fqp282we4x2" path="res://fonts/Pixelify_Sans/static/PixelifySans-Regular.ttf" id="5_lipyx"]
[ext_resource type="Texture2D" uid="uid://ds6siicrhahi8" path="res://player/delete_portal.png" id="5_uk65h"]
[ext_resource type="Texture2D" uid="uid://p0hbynlugb2f" path="res://player/wizard_hat.png" id="6_gtsf6"]

[sub_resource type="GDScript" id="GDScript_fp6gk"]
script/source = "extends Control


@export var player: Player


func _ready() -> void:
	propagate_call(\"set_player\", [player])
	Input.mouse_mode = Input.MOUSE_MODE_HIDDEN


func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		$Pause.visible = !$Pause.visible
		get_tree().paused = $Pause.visible
		if $Pause.visible:
			Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
		else:
			Input.mouse_mode = Input.MOUSE_MODE_HIDDEN
			
"

[sub_resource type="GDScript" id="GDScript_w8sf7"]
script/source = "extends HBoxContainer


const FULL: Texture2D = preload(\"res://player/Health indicator (full).webp\")
const EMPTY: Texture2D = preload(\"res://player/Health indicator (empty).webp\")


func set_player(player: Player) -> void:
	var health := Health.get_health_component(player)
	health.health_changed.connect(
		func(new_health: int):
			for i in range(0, new_health):
				get_child(i).texture = FULL
			for i in range(new_health, get_child_count()):
				get_child(i).texture = EMPTY
	)
	health.max_health_changed.connect(
		func(new_max_health: int):
			if new_max_health >= get_child_count():
				for _i in range(new_max_health - get_child_count()):
					var indicator := TextureRect.new()
					indicator.texture_filter = CanvasItem.TEXTURE_FILTER_NEAREST
					indicator.expand_mode = TextureRect.EXPAND_FIT_WIDTH
					add_child(indicator)
			else:
				for i in range(new_max_health, get_child_count()):
					get_child(i).queue_free()
	)
"

[sub_resource type="Theme" id="Theme_hcktf"]

[sub_resource type="GDScript" id="GDScript_hqk0h"]
script/source = "extends HBoxContainer


const FULL: Texture2D = preload(\"res://player/upgrade icons/shield upgrade icon.png\")


func set_player(player: Player) -> void:
	var health := Health.get_health_component(player)
	health.shield_changed.connect(
		func(new_shield: int):
			if new_shield >= get_child_count():
				for _i in range(new_shield - get_child_count()):
					var indicator := TextureRect.new()
					indicator.texture_filter = CanvasItem.TEXTURE_FILTER_NEAREST
					indicator.expand_mode = TextureRect.EXPAND_FIT_WIDTH
					indicator.texture = FULL
					add_child(indicator)
			else:
				for i in range(new_shield, get_child_count()):
					get_child(i).queue_free()
	)
"

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_28xjp"]
bg_color = Color(0, 0, 0, 0.388235)

[sub_resource type="GDScript" id="GDScript_6fp17"]
script/source = "extends Button


func _ready() -> void:
	if get_window().mode == Window.MODE_FULLSCREEN:
		icon = preload(\"res://player/windowed.png\")
	else:
		icon = preload(\"res://player/fullscreen.png\")


func _on_pressed() -> void:
	if get_window().mode == Window.MODE_FULLSCREEN:
		icon = preload(\"res://player/fullscreen.png\")
		get_window().mode = Window.MODE_WINDOWED
	else:
		icon = preload(\"res://player/windowed.png\")
		get_window().mode = Window.MODE_FULLSCREEN
"

[sub_resource type="GDScript" id="GDScript_adouf"]
script/source = "extends Button


func _on_pressed() -> void:
	OS.set_restart_on_exit(true)
	await get_tree().process_frame
	get_tree().quit()
	#get_tree().change_scene_to_file(\"res://main.tscn\")
"

[sub_resource type="LabelSettings" id="LabelSettings_27pwt"]
font = ExtResource("5_lipyx")
font_size = 14

[sub_resource type="GDScript" id="GDScript_xgkjs"]
script/source = "@tool
extends LabelAutoSizer


func _ready() -> void:
	super()
	if Engine.is_editor_hint():
		return
	text = str(Wallet.coins)
	Wallet.wallet_instance.coins_changed.connect(
		func():
			text = str(Wallet.coins)
	)
"

[sub_resource type="LabelSettings" id="LabelSettings_cs6l1"]
font = ExtResource("5_lipyx")

[sub_resource type="GDScript" id="GDScript_t1ar8"]
script/source = "@tool
extends LabelAutoSizer


func _ready() -> void:
	super()
	if Engine.is_editor_hint():
		return
	text = str(Wallet.wizard_hats)
	Wallet.wallet_instance.wizard_hats_changed.connect(
		func():
			text = str(Wallet.wizard_hats)
	)
"

[sub_resource type="GDScript" id="GDScript_pqjgk"]
script/source = "extends Node2D


@onready var idle: Sprite2D = $Idle
@onready var attack: Sprite2D = $Attack
@onready var delete: Sprite2D = $DeletePortal


func _input(event: InputEvent) -> void:
	if event is InputEventMouseMotion:
		position = get_global_mouse_position()

	elif event.is_action_pressed(\"attack\"):
		idle.hide()
		attack.show()
	
	elif event.is_action_released(\"attack\"):
		idle.show()
		attack.hide()


func _process(_delta: float) -> void:
	position = get_global_mouse_position()
	
	if DeletablePortals.deletable_portals > 0:
		delete.show()
		idle.hide()
		attack.hide()
	elif Input.is_action_pressed(\"attack\"):
		delete.hide()
		idle.hide()
		attack.show()
	else:
		delete.hide()
		idle.show()
		attack.hide()
"

[node name="HUD" type="Control"]
process_mode = 3
texture_filter = 1
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = SubResource("GDScript_fp6gk")

[node name="HealthBar" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.03
anchor_top = 0.03
anchor_right = 0.03
anchor_bottom = 0.12
theme_override_constants/separation = 10
script = SubResource("GDScript_w8sf7")

[node name="TextureRect" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect2" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect3" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="ShieldBar" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.03
anchor_top = 0.13
anchor_right = 0.03
anchor_bottom = 0.22
theme_override_constants/separation = 10
script = SubResource("GDScript_hqk0h")

[node name="Pause" type="Panel" parent="."]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_28xjp")

[node name="Pause" type="TextureRect" parent="Pause"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.4
anchor_right = 0.5
anchor_bottom = 0.6
offset_left = -64.8
offset_right = 64.8
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("2_pm0b2")
expand_mode = 2
stretch_mode = 5

[node name="Fullscreen" type="Button" parent="Pause"]
texture_filter = 1
layout_mode = 1
anchors_preset = -1
anchor_left = 0.251
anchor_top = 0.7
anchor_right = 0.45
anchor_bottom = 0.8
grow_horizontal = 0
icon = ExtResource("3_7ejf0")
icon_alignment = 1
expand_icon = true
script = SubResource("GDScript_6fp17")

[node name="Restart" type="Button" parent="Pause"]
texture_filter = 1
layout_mode = 1
anchors_preset = -1
anchor_left = 0.55
anchor_top = 0.7
anchor_right = 0.68
anchor_bottom = 0.8
grow_vertical = 2
icon = ExtResource("3_6tax7")
icon_alignment = 1
expand_icon = true
script = SubResource("GDScript_adouf")

[node name="VBoxContainer2" type="VBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.974
anchor_top = 0.01
anchor_right = 0.99
anchor_bottom = 0.01
offset_left = -40.0
offset_bottom = 40.0
grow_horizontal = 0

[node name="TextureRect" type="TextureRect" parent="VBoxContainer2"]
layout_mode = 2
texture = ExtResource("5_iavf7")
expand_mode = 4
stretch_mode = 5

[node name="TextureRect2" type="TextureRect" parent="VBoxContainer2"]
layout_mode = 2
texture = ExtResource("6_gtsf6")
expand_mode = 4
stretch_mode = 5

[node name="VBoxContainer" type="VBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.934
anchor_top = 0.01
anchor_right = 0.934
anchor_bottom = 0.125
offset_left = -40.0
offset_bottom = 40.0
grow_horizontal = 0

[node name="Label" type="Label" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 20)
layout_mode = 2
size_flags_vertical = 6
text = "0"
label_settings = SubResource("LabelSettings_27pwt")
horizontal_alignment = 2
autowrap_mode = 3
clip_text = true
script = SubResource("GDScript_xgkjs")
_max_steps = 10
_size_just_modified_by_autosizer = false
_set_defaults = true
_base_font_size = 14
_current_font_size = 14
_last_size_state = 1

[node name="Label2" type="Label" parent="VBoxContainer"]
custom_minimum_size = Vector2(0, 20)
layout_mode = 2
size_flags_vertical = 6
text = "0"
label_settings = SubResource("LabelSettings_cs6l1")
horizontal_alignment = 2
autowrap_mode = 3
clip_text = true
script = SubResource("GDScript_t1ar8")
_max_steps = 10
_size_just_modified_by_autosizer = false
_set_defaults = true
_base_font_size = 16
_current_font_size = 16
_last_size_state = 1

[node name="Node2D" type="Node2D" parent="."]
script = SubResource("GDScript_pqjgk")

[node name="Idle" type="Sprite2D" parent="Node2D"]
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("3_ki1ma")

[node name="Attack" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("4_d36ju")

[node name="DeletePortal" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("5_uk65h")

[connection signal="pressed" from="Pause/Fullscreen" to="Pause/Fullscreen" method="_on_pressed"]
[connection signal="pressed" from="Pause/Restart" to="Pause/Restart" method="_on_pressed"]
