[gd_scene load_steps=11 format=3 uid="uid://cpg817r11rxxe"]

[ext_resource type="Texture2D" uid="uid://jkh3db66e5w3" path="res://player/Health indicator (full).webp" id="1_h1oyn"]
[ext_resource type="Texture2D" uid="uid://buel4iifkemvw" path="res://player/pause.png" id="2_pm0b2"]
[ext_resource type="Texture2D" uid="uid://c7w7w04ymhr1m" path="res://player/idle-mouse.png" id="3_ki1ma"]
[ext_resource type="Texture2D" uid="uid://bbn1mcu6qaovu" path="res://player/attack-mouse.png" id="4_d36ju"]
[ext_resource type="Texture2D" uid="uid://ds6siicrhahi8" path="res://player/delete_portal.png" id="5_uk65h"]

[sub_resource type="GDScript" id="GDScript_fp6gk"]
script/source = "extends Control


@export var player: Player


func _ready() -> void:
	propagate_call(\"set_player\", [player])
	Input.mouse_mode = Input.MOUSE_MODE_HIDDEN


func _input(event: InputEvent) -> void:
	if event.is_action_pressed(\"ui_cancel\"):
		$Pause.visible = !$Pause.visible
		get_tree().paused = $Pause.visible
		if $Pause.visible:
			Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
		else:
			Input.mouse_mode = Input.MOUSE_MODE_HIDDEN
			
"

[sub_resource type="GDScript" id="GDScript_w8sf7"]
script/source = "extends HBoxContainer


const FULL: Texture2D = preload(\"res://player/Health indicator (full).webp\")
const EMPTY: Texture2D = preload(\"res://player/Health indicator (empty).webp\")


func set_player(player: Player) -> void:
	var health := Health.get_health_component(player)
	health.health_changed.connect(
		func(new_health: int):
			for i in range(0, new_health):
				get_child(i).texture = FULL
			for i in range(new_health, get_child_count()):
				get_child(i).texture = EMPTY
	)
	health.max_health_changed.connect(
		func(new_max_health: int):
			if new_max_health >= get_child_count():
				for _i in range(new_max_health - get_child_count()):
					var indicator := TextureRect.new()
					indicator.texture_filter = CanvasItem.TEXTURE_FILTER_NEAREST
					indicator.expand_mode = TextureRect.EXPAND_FIT_WIDTH
					add_child(indicator)
			else:
				for _i in range(new_max_health, get_child_count()):
					get_child(new_max_health).queue_free()
	)
"

[sub_resource type="Theme" id="Theme_hcktf"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_28xjp"]
bg_color = Color(0, 0, 0, 0.388235)

[sub_resource type="GDScript" id="GDScript_pqjgk"]
script/source = "extends Node2D


@onready var idle: Sprite2D = $Idle
@onready var attack: Sprite2D = $Attack
@onready var delete: Sprite2D = $DeletePortal


func _input(event: InputEvent) -> void:
	if event is InputEventMouseMotion:
		position = get_global_mouse_position()

	elif event.is_action_pressed(\"attack\"):
		idle.hide()
		attack.show()
	
	elif event.is_action_released(\"attack\"):
		idle.show()
		attack.hide()


func _process(_delta: float) -> void:
	position = get_global_mouse_position()
	
	if DeletablePortals.deletable_portals > 0:
		delete.show()
		idle.hide()
		attack.hide()
	elif Input.is_action_pressed(\"attack\"):
		delete.hide()
		idle.hide()
		attack.show()
	else:
		delete.hide()
		idle.show()
		attack.hide()
"

[node name="HUD" type="Control"]
process_mode = 3
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
script = SubResource("GDScript_fp6gk")

[node name="HealthBar" type="HBoxContainer" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.03
anchor_top = 0.03
anchor_right = 0.03
anchor_bottom = 0.12
theme_override_constants/separation = 10
script = SubResource("GDScript_w8sf7")

[node name="TextureRect" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect2" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="TextureRect3" type="TextureRect" parent="HealthBar"]
texture_filter = 1
layout_mode = 2
theme = SubResource("Theme_hcktf")
texture = ExtResource("1_h1oyn")
expand_mode = 2

[node name="Pause" type="Panel" parent="."]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_28xjp")

[node name="Pause" type="TextureRect" parent="Pause"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.4
anchor_right = 0.5
anchor_bottom = 0.6
offset_left = -64.8
offset_right = 64.8
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("2_pm0b2")
expand_mode = 2
stretch_mode = 5

[node name="Node2D" type="Node2D" parent="."]
script = SubResource("GDScript_pqjgk")

[node name="Idle" type="Sprite2D" parent="Node2D"]
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("3_ki1ma")

[node name="Attack" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("4_d36ju")

[node name="DeletePortal" type="Sprite2D" parent="Node2D"]
visible = false
texture_filter = 1
position = Vector2(42, 42)
scale = Vector2(4, 4)
texture = ExtResource("5_uk65h")
